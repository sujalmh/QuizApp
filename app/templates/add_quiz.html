<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create a Quiz</title>
    <script>
        function addQuestion() {
            const questionsContainer = document.getElementById('questions-container');
            const questionIndex = questionsContainer.children.length;
            const questionHTML = `
                <div class="question">
                    <label>Question: <input type="text" name="questions[${questionIndex}][text]"></label>
                    <label>Points: <input type="number" name="questions[${questionIndex}][points]" min="1"></label>
                    <div class="options-container">
                        <!-- Options will be added here -->
                    </div>
                    <button type="button" onclick="addOption(this, ${questionIndex})">Add Option</button>
                    <label>Correct Answer: 
                        <select name="questions[${questionIndex}][correct_answer]">
                            <!-- Correct answer options will be added here -->
                        </select>
                    </label>
                </div>
            `;
            questionsContainer.insertAdjacentHTML('beforeend', questionHTML);
        }

        function addOption(button, questionIndex) {
            const optionsContainer = button.previousElementSibling;
            const inputs = optionsContainer.querySelectorAll('input[type="text"]');
            const newOptionIndex = inputs.length;

            // Check for empty inputs before adding a new option
            for (const input of inputs) {
                if (input.value.trim() === '') {
                    alert('Option cannot be empty.');
                    return; // Prevent adding a new option
                }
            }

            // Check for duplicate values
            const values = Array.from(inputs).map(input => input.value.trim());
            const hasDuplicates = new Set(values).size !== values.length;
            if (hasDuplicates) {
                alert('Options cannot be the same.');
                return; // Prevent adding a new option if duplicates are found
            }

            // If validations pass, add new option
            const optionHTML = `
                <div class="option">
                    <label>Option ${newOptionIndex + 1}: <input type="text" name="questions[${questionIndex}][options][${newOptionIndex}]" onchange="updateCorrectAnswerOptions(this, ${questionIndex})"></label>
                </div>
            `;
            optionsContainer.insertAdjacentHTML('beforeend', optionHTML);
            updateCorrectAnswerOptions(null, questionIndex);
        }

        function updateCorrectAnswerOptions(input, questionIndex) {
            const questionDiv = document.getElementById('questions-container').children[questionIndex];
            const optionsContainer = questionDiv.querySelector('.options-container');
            const correctAnswerSelect = questionDiv.querySelector('select');
            let optionsHTML = '';

            for (let i = 0; i < optionsContainer.children.length; i++) {
                const optionValue = optionsContainer.children[i].querySelector('input').value || `Option ${i + 1}`;
                optionsHTML += `<option value="${i}">${optionValue}</option>`;
            }

            correctAnswerSelect.innerHTML = optionsHTML;
        }
    </script>
</head>
<body>
    <h1>Create a New Quiz</h1>
    <form action="{{ url_for('main.add_quiz') }}" method="post">
        <label>Quiz Title: <input type="text" name="quiz_title"></label>
        <label>Quiz Time (minutes): <input type="number" name="quiz_time" min="1"></label>
        <label>Number of Questions to Display: <input type="number" name="num_questions_display" min="1"></label>
        <label for="start_time">Start Time:</label>
        <input type="datetime-local" id="start_time" name="start_time">
        
        <label for="end_time">End Time:</label>
        <input type="datetime-local" id="end_time" name="end_time">
    
        <!-- Add the questions-container div here -->
        <div id="questions-container">
            <!-- Questions will be added here dynamically -->
        </div>

        <button type="button" onclick="addQuestion()">Add Question</button>
        <input type="submit" value="Submit Quiz">
    </form>
    
    <a href="{{ url_for('main.admin_dashboard') }}">Back to Dashboard</a>
</body>
</html>
